<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SpeechSummarizer</title>

  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <!-- Top Nav -->
  <div class="nav">
    <div class="brand">
      <div class="title">SpeechSummarizer</div>
      <div class="sub">AI音声認識システム</div>
    </div>

    <div class="nav-center">
      <!-- <div class="pill"><span class="dot" id="dotWs"></span><span id="wsStatus">disconnected</span></div> -->
      
      <!-- <div class="pill">カルテ: <span id="patientIdNav">(未設定)</span></div> -->
    </div>

    <div class="nav-right">
      <div class="pill">level: <span id="level">-</span> dBFS</div>
      <select id="selAsrModel" class="btn" style="padding:10px 12px; min-width: 140px;">
        <option value="">ASR model...</option>
      </select>
      <button id="btnRec" class="btn btn-rec" title="録音開始 / 停止">
        <svg class="mic-icon" viewBox="0 0 24 24">
          <path d="M12 15a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a1 1 0 1 0-2 0 3 3 0 0 1-6 0 1 1 0 1 0-2 0 5 5 0 0 0 4 4.9V19H9a1 1 0 0 0 0 2h6a1 1 0 0 0 0-2h-2v-2.1A5 5 0 0 0 17 12z"/>
        </svg>
      </button>

      <button class="btn btn-primary" id="btnStart" style="display:none">Start</button>
      <button class="btn btn-danger" id="btnStop" style="display:none">Stop</button>

      <button class="btn" id="btnToggleLog" aria-pressed="false" title="ログ表示/非表示">
        ログ
      </button>

      <label class="toggle" title="患者さんに見せる字幕を巨大化します">
        <input type="checkbox" id="chkHearing">
        難聴
      </label>
    </div>
  </div>

  <!-- Main -->
  <div class="grid">
    <!-- Left: patient + transcript -->
    <div class="card patient-card">
      <div class="hd">
        <h3>ASR情報</h3>
        <select id="selSession" class="select" title="過去の認識結果">
          <option value="">認識履歴</option>
        </select>

      </div>
      <div class="bd">
        <div class="meta-row">
          <span class="meta-item">ID: <b id="patientId">(未設定)</b></span>
          <span class="meta-sep">/</span>
          <span class="meta-item">ASR: <b id="asrModelName">(未設定)</b></span>
        </div>
      </div>

      <div class="hd">
        <h3>認識テキスト</h3>
        
        <div class="summary-ctrl">
          <div class="ctrl-row row1">
            <button class="btn btn-sm" id="btnCorrectAsr" title="認識テキストをルールで補正">補正</button>
            <button class="btn btn-sm" id="btnRebuild" title="JSONL原本から .txt を再生成して戻す">元に戻す</button>
            <button class="btn btn-sm" id="btnCopyAsr" title="音声認識結果をコピー">Copy</button>
          </div>
        </div>
      </div>
      <div class="bd">
        <textarea id="transcript" class="transcript" spellcheck="false"></textarea>
      </div>

      <div class="hd summary-block">
        <h3 class="summary-title">AI処理</h3>

        <!-- 右側：2行固定 -->
        <div class="summary-ctrl">
          <div class="ctrl-row row1">
            <select id="selLlmModel" class="select select-sm" title="LLMモデル">
              <option value="">LLM model...</option>
            </select>
            <select id="selSoapPrompt" class="select select-sm" title="プロンプト">
              <option value="">Prompt...</option>
            </select>
            <button class="btn btn-primary btn-sm" id="btnSoap" title="Ollamaで処理">送信</button>
          </div>

          <div class="ctrl-row row2">
            <select id="selSoapHistory" class="select select-sm" title="過去要約一覧">
              <option value="">履歴…</option>
            </select>
            <button class="btn btn-sm" id="btnCopySoap" title="AI処理結果をコピー">Copy</button>
          </div>
        </div>
      </div>

      <div class="bd summary-block">
        <textarea id="summary" class="summary" spellcheck="false" placeholder="AI処理結果"></textarea>
      </div>
    </div>

    <!-- Right: log -->
    <div class="card log-card">
      <div class="hd">
        <h3>ログ</h3>
        <div class="muted2">events</div>
      </div>
      <div class="bd">
        <div id="log"></div>
      </div>
    </div>
  </div>

<script src="/static/common.js"></script>
</body>
</html>
